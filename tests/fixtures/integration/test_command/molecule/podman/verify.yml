---
- name: Verify
  hosts: molecule
  gather_facts: false
  tasks:
    - name: Read file content
      ansible.builtin.slurp:
        src: /tmp/converge.txt
      register: file

    - name: Validate file content
      ansible.builtin.assert:
        that: "{{ file.content | b64decode | trim == 'Hello from converge' }}"
        fail_msg: "File content validation failed"

    - name: Confirm custom_host_var from provisioner
      ansible.builtin.assert:
        that:
          - custom_host_var == "set_by_provisioner"
        fail_msg: "Expected custom_host_var to be set_by_provisioner, but it was not"
